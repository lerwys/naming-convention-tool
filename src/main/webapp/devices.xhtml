<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/namesTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html">

    <ui:define name="content">
        <h:form id="ManageNameForm">
            <p:growl id="ncRequestMsgs" showDetail="true" sticky="false" life="30000" />

            <!-- =================== Menus ============================ -->
            <p:menu id="ncReqMenu" styleClass="fixedPosition box"
                    style="width: 8%; z-index: 100;">
                <p:submenu label="Device Names">
                    <p:menuitem value="Add" icon="ui-icon-plus" update=":addDeviceNameForm"
                                oncomplete="addDeviceName.show()" title="Add Device Name"
                                action="#{devicesController.prepareForAdd()}"
                                rendered="#{userManager.editor}" />
                    <p:menuitem value="Delete" icon="ui-icon-trash"
                            update=":delDeviceNameForm" oncomplete="delDeviceName.show()"
                            title="Delete Device Name" rendered="#{userManager.editor}"
                disabled="#{empty devicesController.selectedDeviceName || devicesController.selectedDeviceName.device.deleted || devicesController.selectedDeviceName.requestedBy.username != userManager.user.username}" />
                    <p:menuitem value="Modify" icon="ui-icon-pencil"
                            update=":modDeviceNameForm" oncomplete="modDeviceName.show()"
                            action="#{devicesController.prepareForModify()}"
                            title="Modify Device Name" rendered="#{userManager.editor}"
                disabled="#{empty devicesController.selectedDeviceName || devicesController.selectedDeviceName.device.deleted || devicesController.selectedDeviceName.requestedBy.username != userManager.user.username}" />
                    <p:menuitem value="History" icon="ui-icon-search"
                            actionListener="#{devicesController.loadHistory()}"
                            update=":ManageNameForm:historyTable" title="View History"
                            oncomplete="nameDetail.show()"
                            disabled="#{empty devicesController.selectedDeviceName}" />
                </p:submenu>
            </p:menu>

            <p:contextMenu id="ncCntxtMenu" for="ncCrTable">
                <p:menuitem value="Add" icon="ui-icon-plus"
                            action="#{devicesController.prepareForAdd()}"
                            oncomplete="addDeviceName.show()"
                            rendered="#{userManager.editor}" />
                <p:menuitem value="Delete" update=":delDeviceNameForm"
                            icon="ui-icon-trash" oncomplete="delDeviceName.show()"
                        rendered="#{userManager.editor}"/> 
                <p:menuitem value="Modify" update=":modDeviceNameForm"
                            action="#{devicesController.prepareForModify()}"
                        icon="ui-icon-pencil" oncomplete="modDeviceName.show()"
                        rendered="#{userManager.editor}" />
                <p:menuitem value="History" icon="ui-icon-search"
                        actionListener="#{devicesController.loadHistory()}"
                        update=":ManageNameForm:historyTable" oncomplete="nameDetail.show()"/>
            </p:contextMenu>

            <!-- ===================Data Table============================ -->
            <p:dataTable id="ncCrTable" var="deviceName" value="#{devicesController.allDeviceNames}"
                         paginator="true" rows="50" resizableColumns="true" rowKey="#{deviceName.id}"
                         emptyMessage="There are no NC Names" rowStyleClass="#{deviceName.device.deleted ? 'Deleted' : ''}"
                         selection="#{devicesController.selectedDeviceName}" style="width: 90%">
                <f:facet name="header">
                    <h:outputText value="Existing Device Names" />
                </f:facet>

                <p:ajax event="rowSelectRadio" update=":ManageNameForm:ncReqMenu :modDeviceNameForm" />
                <p:column selectionMode="single" style="width: 5%" />

                <p:column id="nameString" headerText="Convention Name" filterBy="#{deviceName.conventionName}" filterMatchMode="contains" style="width: 20%">
                    <h:outputText value="#{deviceName.conventionName}" />
                </p:column>
                <p:column id="nameSection" headerText="Section" filterBy="#{deviceName.section.fullName}" filterMatchMode="contains" style="width: 30%">
                    <h:outputText value="#{deviceName.sectionPath}" />
                </p:column>
                <p:column id="nameDeviceType" headerText="Device type" filterBy="#{deviceName.deviceType.fullName}" filterMatchMode="contains" style="width: 30%">
                    <h:outputText value="#{deviceName.deviceTypePath}" />
                </p:column>
                <p:column id="nameQualifier" headerText="Qualifier" filterBy="#{deviceName.qualifier}" filterMatchMode="contains" style="width: 20%">
                    <h:outputText value="#{deviceName.qualifier}" />
                </p:column>
                <p:column id="nameStatus">
                    <f:facet name="header">
                        <h:outputText value="Status" />
                        <br />
                        <p:selectBooleanButton value="#{devicesController.showDeletedNames}" onLabel="Deleted" offLabel="Deleted" onIcon="ui-icon-check" offIcon="ui-icon-close">
                            <p:ajax update="ncCrTable"  listener="#{devicesController.loadDeviceNames}"/>
                        </p:selectBooleanButton>
                    </f:facet>
                    <h:outputText value="#{deviceName.device.deleted ? 'Deleted' : ''}" />
                </p:column>
            </p:dataTable>

            <ui:include src="/WEB-INF/includes/devices-history.xhtml" >
                <ui:param name="historyHandler" value="#{devicesController.historyEvents}" />
            </ui:include>

        </h:form>

        <ui:include src="/WEB-INF/includes/devices-add-mod-form.xhtml" >
            <ui:param name="formId" value="addDeviceNameForm" />
            <ui:param name="dialogTitle" value="Add Device Name" />
            <ui:param name="widgetName" value="addDeviceName" />
            <ui:param name="submitHandler" value="onAdd" />
        </ui:include>

        <ui:include src="/WEB-INF/includes/devices-add-mod-form.xhtml" >
            <ui:param name="formId" value="modDeviceNameForm" />
            <ui:param name="dialogTitle" value="Modify Device Name" />
            <ui:param name="widgetName" value="modDeviceName" />
            <ui:param name="submitHandler" value="onModify" />
        </ui:include>

        <!-- ===================Delete Form================================= -->
        <h:form id="delDeviceNameForm">
            <p:dialog id="delDeviceName" widgetVar="delDeviceName" modal="true">
                <f:facet name="header">
                    <h:outputText value="Delete/Retire Naming Convention Name" />
                </f:facet>
                <p:panelGrid id="pgrid" style="text-align: left">
                    <p:row>
                        <p:column style="width: 128px">
                            <h:outputText
                                    value="#{devicesController.selectedDeviceName.section.fullName}" />
                        </p:column>
                        <p:column style="width: 128px">
                            <h:outputText
                                    value="#{devicesController.selectedDeviceName.deviceType.fullName}" />
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column colspan="4">
                            <h:outputText value="#{devicesController.selectedDeviceName.conventionName}" />
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:separator />

                <p:commandButton value="Submit" style="float: left"
                        update=":ManageNameForm" oncomplete="delDeviceName.hide()"
                        action="#{devicesController.onDelete()}" />
                <p:commandButton value="Cancel" style="float: right"
                        onclick="delDeviceName.hide()" />
            </p:dialog>
        </h:form>

    </ui:define>
</ui:composition>
