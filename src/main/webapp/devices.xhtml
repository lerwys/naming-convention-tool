<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/namesTemplate.xhtml"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">

	<ui:define name="content">
		<h:form id="ManageNameForm">
			<p:growl id="ncRequestMsgs" showDetail="true" sticky="false"
				life="30000" />

			<!-- =================== Menus ============================ -->
			<table width="100%" id="filterTable">
				<tr>
					<td align="left">
						<div>
							<h:panelGrid columns="2">
								<h:outputText value="Show: " />
								<p:selectOneMenu value="#{devicesController.viewFilter}">
									<p:ajax listener="#{devicesController.modifyDisplayView}"
										event="change" update="devicesTree ncReqMenu"
										oncomplete="resizePanel()" />
									<f:selectItem itemLabel="Active and Archived" itemValue="1" />
									<f:selectItem itemLabel="Active Only" itemValue="2" />
								</p:selectOneMenu>
							</h:panelGrid>
						</div>
					</td>
					<td align="right"><p:menuButton id="ncReqMenu" value="Actions"
							style="width: 8%; z-index: 100;">
							<p:menuitem value="Add" icon="ui-icon-plus"
								update=":addDeviceNameForm" oncomplete="addDeviceName.show()"
								title="Add Device Name"
								action="#{devicesController.prepareForAdd()}"
								disabled="#{!devicesController.canAdd()}"
								rendered="#{userManager.editor}" />
							<p:menuitem value="Delete" icon="ui-icon-trash"
								update=":delDeviceNameForm" oncomplete="delDeviceName.show()"
								title="Delete Device Name" rendered="#{userManager.editor}"
								disabled="#{!devicesController.canDelete()}" />
							<p:menuitem value="Modify" icon="ui-icon-pencil"
								update=":modDeviceNameForm" oncomplete="modDeviceName.show()"
								action="#{devicesController.prepareForModify()}"
								title="Modify Device Name" rendered="#{userManager.editor}"
								disabled="#{!devicesController.canModify()}" />
							<p:menuitem value="History" icon="ui-icon-search"
								actionListener="#{devicesController.loadHistory()}"
								update=":ManageNameForm:historyTable" title="View History"
								oncomplete="nameDetail.show()"
								disabled="#{!devicesController.canShowHistory()}" />
							<p:menuitem value="Batch Import" icon="ui-icon-folder-open"
								title="Batch Import" update=":batchImportForm"
								oncomplete="batchImport.show()" />
						</p:menuButton></td>
				</tr>
			</table>
			<!-- <p:contextMenu id="ncCntxtMenu" for="devicesTree">
                <p:menuitem value="Add" icon="ui-icon-plus" action="#{devicesController.prepareForAdd()}" oncomplete="addDeviceName.show()" rendered="#{userManager.editor}" />
                <p:menuitem value="Delete" update=":delDeviceNameForm" icon="ui-icon-trash" oncomplete="delDeviceName.show()" rendered="#{userManager.editor}"/>
                <p:menuitem value="Modify" update=":modDeviceNameForm" action="#{devicesController.prepareForModify()}" icon="ui-icon-pencil" oncomplete="modDeviceName.show()" rendered="#{userManager.editor}" />
                <p:menuitem value="History" icon="ui-icon-search" actionListener="#{devicesController.loadHistory()}" update=":ManageNameForm:historyTable" oncomplete="nameDetail.show()"/>
            </p:contextMenu> -->

			<p:treeTable id="devicesTree" value="#{devicesController.viewRoot}"
				resizableColumns="true" liveResize="true" var="namePart"
				selection="#{devicesController.selectedNodes}"
				selectionMode="multiple" scrollable="true" scrollWidth="auto"
				rowStyleClass="Approved" style="padding-top:5px;">
				<p:ajax event="select"
					update=":ManageNameForm:ncReqMenu :modDeviceNameForm" />
				<p:ajax event="unselect"
					update=":ManageNameForm:ncReqMenu :modDeviceNameForm" />

				<p:column id="devName" headerText="Device Name"
					filterBy="#{namePart.fullName}" filterMatchMode="contains">
					<h:outputText value=""
						style="display:inline-block; vertical-align:bottom !important"
						styleClass="ui-icon ui-icon-wrench"
						rendered="#{namePart['class'].simpleName eq 'DeviceView'}" />
					<h:outputText value="#{namePart.conventionName}"
						styleClass="#{namePart.device.deleted ? 'Deleted' : 'Insert-Approved-Old'}"
						rendered="#{namePart['class'].simpleName eq 'DeviceView'}" />
					<h:outputText value="#{namePart.fullName}"
						styleClass="Insert-Approved-Old"
						rendered="#{namePart['class'].simpleName eq 'NamePartView'}" />
				</p:column>
				<p:column id="devType" headerText="Device Type"
					filterBy="#{namePart.deviceTypePath}" filterMatchMode="startsWith"
					style="width: 30%">
					<h:outputText value="#{namePart.deviceTypePath}"
						styleClass="#{namePart.device.deleted ? 'Deleted' : 'Insert-Approved-Old'}"
						rendered="#{namePart['class'].simpleName eq 'DeviceView'}" />
					<h:outputText value="" styleClass="Insert-Approved-Old"
						rendered="#{namePart['class'].simpleName eq 'NamePartView'}" />
				</p:column>


			</p:treeTable>

			<!-- ===================Data Table============================ -->
			<!-- <p:dataTable id="ncCrTable" var="deviceName" value="#{devicesController.allDeviceNames}"
                         resizableColumns="true" rowKey="#{deviceName.id}"
                         emptyMessage="There are no NC Names" rowStyleClass="#{deviceName.device.deleted ? 'Deleted' : ''}"
                         selection="#{devicesController.selectedDeviceName}" scrollable="true" scrollHeight="630" style="padding-top: 10px">
                <f:facet name="header">
                    <h:outputText value="Existing Device Names" />
                </f:facet>

                <p:ajax event="rowSelectRadio" update=":ManageNameForm:ncReqMenu :modDeviceNameForm" />
                <p:column selectionMode="single" style="width: 5%" />

                <p:column id="nameString" headerText="Convention Name" filterBy="#{deviceName.conventionName}" filterMatchMode="contains" style="width: 20%">
                    <h:outputText value="#{deviceName.conventionName}" />
                </p:column>
                <p:column id="nameSection" headerText="Section" filterBy="#{deviceName.section.fullName}" filterMatchMode="contains" style="width: 30%">
                    <h:outputText value="#{deviceName.sectionPath}" />
                </p:column>
                <p:column id="nameDeviceType" headerText="Device type" filterBy="#{deviceName.deviceType.fullName}" filterMatchMode="contains" style="width: 30%">
                    <h:outputText value="#{deviceName.deviceTypePath}" />
                </p:column>
                <p:column id="nameQualifier" headerText="Qualifier" filterBy="#{deviceName.qualifier}" filterMatchMode="contains" style="width: 20%">
                    <h:outputText value="#{deviceName.qualifier}" />
                </p:column>
                <p:column id="nameStatus">
                    <f:facet name="header">
                        <h:outputText value="Status" />
                        <br />
                        <p:selectBooleanButton value="#{devicesController.showDeletedNames}" onLabel="Deleted" offLabel="Deleted" onIcon="ui-icon-check" offIcon="ui-icon-close">
                            <p:ajax update="ncCrTable"  listener="#{devicesController.loadDeviceNames}"/>
                        </p:selectBooleanButton>
                    </f:facet>
                    <h:outputText value="#{deviceName.device.deleted ? 'Deleted' : ''}" />
                </p:column>
            </p:dataTable> -->

			<ui:include src="/WEB-INF/includes/devices-history.xhtml">
				<ui:param name="historyHandler"
					value="#{devicesController.historyEvents}" />
			</ui:include>

		</h:form>

		<ui:include src="/WEB-INF/includes/devices-add-form.xhtml">
			<ui:param name="formId" value="addDeviceNameForm" />
			<ui:param name="dialogTitle" value="Add Device Name" />
			<ui:param name="widgetName" value="addDeviceName" />
			<ui:param name="submitHandler" value="onAdd" />
		</ui:include>

		<ui:include src="/WEB-INF/includes/devices-mod-form.xhtml">
			<ui:param name="formId" value="modDeviceNameForm" />
			<ui:param name="dialogTitle" value="Modify Device Name" />
			<ui:param name="widgetName" value="modDeviceName" />
			<ui:param name="submitHandler" value="onModify" />
		</ui:include>


		<h:form id="delDeviceNameForm">
			<p:dialog id="delDeviceName" widgetVar="delDeviceName" modal="true"
				resizable="false">
				<f:facet name="header">
					<h:outputText value="Request to Delete/Retire Device Names" />
				</f:facet>
				<p:panelGrid id="pgrid" style="text-align: left">
					<p:row>
						<p:column colspan="2" rendered="#{devicesController.canDelete()}">
							<p:treeTable value="#{devicesController.deleteView}"
								var="candidate" liveResize="true" scrollable="true" resizableColumns="true"
								styleClass="previewTreeTable">
								<p:column headerText="Device Name">
									<h:outputText value=""
										style="display:inline-block; vertical-align:bottom !important"
										styleClass="ui-icon ui-icon-wrench"
										rendered="#{candidate['class'].simpleName eq 'OperationDeviceView'}" />
									<h:outputText
										styleClass="#{candidate.affected ? 'Processing Delete-Processing' : ''}"
										value="#{candidate.deviceView.conventionName}"
										rendered="#{candidate['class'].simpleName eq 'OperationDeviceView'}" />
									<h:outputText
										styleClass="#{candidate.affected ? 'Processing Delete-Processing' : ''}"
										value="#{candidate.namePartView.fullName}"
										rendered="#{candidate['class'].simpleName eq 'OperationNamePartView'}" />

								</p:column>
								<p:column headerText="Device Type" style="width: 50%">
									<h:outputText
										styleClass="#{candidate.affected ? 'Processing Delete-Processing' : ''}"
										value="#{candidate.deviceView.deviceTypePath}"
										rendered="#{candidate['class'].simpleName eq 'OperationDeviceView'}" />
									<h:outputText
										styleClass="#{candidate.affected ? 'Processing Delete-Processing' : ''}"
										value=""
										rendered="#{candidate['class'].simpleName eq 'OperationNamePartView'}" />

								</p:column>
							</p:treeTable>
						</p:column>
					</p:row>
				</p:panelGrid>
				<p:separator />
				<p:commandButton value="Submit" style="float: left"
					update=":ManageNameForm"
					oncomplete="delDeviceName.hide() resizePanel()"
					action="#{devicesController.onDelete()}" />
				<p:commandButton value="Cancel" style="float: right"
					onclick="delDeviceName.hide()" />

			</p:dialog>
		</h:form>

		<h:form id="batchImportForm" enctype="multipart/form-data">
			<p:dialog id="batchImport" widgetVar="batchImport" modal="true"
				resizable="false" width="40%">
				<f:facet name="header">
					<h:outputText value="Batch Import Device Names From Excell File" />
				</f:facet>
				
                 <h:outputText value="Select excell file to upload device names from" />
	                    
				 <p:fileUpload fileUploadListener="#{devicesController.handleFileUpload}" mode="advanced" dragDropSupport="false" showButtons="false"
			                  update="messages" fileLimit="1" allowTypes="/(\.|\/)(xlsx|xls)$/"  />
				
				<p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" />		

				<p:separator />
				
				<p:commandButton value="Cancel" style="float: right"
					onclick="batchImport.hide()" />

			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>
