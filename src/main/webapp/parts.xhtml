<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/namesTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                >
    <ui:define name="content">
        <h:outputText value="You must be a device editor to perform this action." rendered="#{not userManager.editor}" />
        <h:form id="ReqSubForm" rendered="#{userManager.editor}">
            <!--<p:growl id="requestMsgs" showDetail="true" sticky="false"  life="30000" />-->

            <!-- =================== Menus      ============================ -->
            <p:menu id="reqMenu" styleClass="fixedPosition box" style="width: 8%">
                <p:submenu label="Requests">
                    <p:menuitem value="Add" title="Add Name" icon="ui-icon-plus" oncomplete="addName.show()" update=":addNameForm :ReqSubForm:namePartsTree" disabled="#{!requestManager.canAdd()}" />
                    <p:menuitem value="Delete" title="Delete Name" icon="ui-icon-trash" update=":DelNameForm:delName" oncomplete="delName.show()" disabled="#{!requestManager.canDelete()}" />
                    <p:menuitem value="Modify" title="Modify Name" icon="ui-icon-pencil" update=":ModNameForm:modName" oncomplete="modName.show()" disabled="#{!requestManager.canModify()}" />
                    <p:menuitem value="History" title="View History" icon="ui-icon-search" actionListener="#{requestManager.findHistory()}" update=":ReqSubForm:historyTable" oncomplete="nameDetail.show()" disabled="#{fn:length(requestManager.selectedNodes) != 1}" />
                    <p:menuitem value="Approve" title="Approve Request" icon="ui-icon-check" update=":ApproveForm" oncomplete="approveRequest.show()" />
                    <p:menuitem value="Reject" title="Reject Request" icon="ui-icon-close" update=":RejectForm" oncomplete="rejectRequest.show()" />
                    <p:menuitem value="Cancel" title="Cancel changes" icon="ui-icon-close" update=":CancelReqForm:cancelReq" oncomplete="cancelReq.show()" disabled="#{!requestManager.canCancel()}" />
                </p:submenu>
            </p:menu>

            <p:treeTable id="namePartsTree" value="#{requestManager.root}" var="namePart" selection="#{requestManager.selectedNodes}" selectionMode="multiple" resizableColumns="true" rowStyleClass="#{namesManager.nameViewClass(namePart)}" style="width: 90%; margin-top: 30px">
                <p:ajax event="select" update=":ReqSubForm:reqMenu" />
                <p:ajax event="unselect" update=":ReqSubForm:reqMenu" />

                <p:column id="nameDesc" headerText="Name" filterBy="#{namePart.fullName}" filterMatchMode="contains" >
                    <h:outputText value="#{requestManager.getNewFullName(namePart)}" styleClass="#{requestManager.getNameClass(namePart)}" />
                    <h:outputText value=" " rendered="#{requestManager.isModified(namePart)}" />
                    <h:outputText value="(#{namePart.fullName})" styleClass="#{requestManager.getNameClass(namePart)}-Old" rendered="#{requestManager.isModified(namePart)}" />
                </p:column>
                <p:column id="nameCode" headerText="Mnemonic" filterBy="#{namePart.name}" filterMatchMode="startsWith" style="width: 10%">
                    <h:outputText value="#{requestManager.getNewName(namePart)}" styleClass="#{requestManager.getNameClass(namePart)}-New" />
                    <h:outputText value=" " rendered="#{requestManager.isModified(namePart)}" />
                    <h:outputText value="(#{namePart.name})" styleClass="#{requestManager.getNameClass(namePart)}-Old" rendered="#{requestManager.isModified(namePart)}" />
                </p:column>
                <p:column id="status" headerText="Status" style="width: 15%">
                    <h:outputText value="#{namesManager.nameStatus(namePart.nameEvent)}" styleClass="#{requestManager.getNameClass(namePart)}" />
                </p:column>

            </p:treeTable>

            <ui:include src="/WEB-INF/includes/part-history.xhtml" >
                <ui:param name="historyHandler" value="#{requestManager.historyEvents}" />
            </ui:include>
        </h:form>

        <!-- ===================Add Form================================= -->
        <h:form id="addNameForm" >
            <p:dialog id="addName"  widgetVar="addName">
                <f:facet name="header">
                    <h:outputText value="Request to Add Name"/>
                </f:facet>
                <p:panelGrid id="grid" columns="2" style="text-align: left">
                    <h:outputLabel for="idesc" value="Name:" />
                    <h:panelGroup>
                        <p:inputText id="idesc" value="#{requestManager.newDescription}" required="true" requiredMessage="Please enter a name." />
                        <p:watermark for="idesc" value="e.g. Flux Capacitor" />
                        <p:message for="idesc" />
                    </h:panelGroup>

                    <h:outputLabel for="icode" value="Mnemonic:" />
                    <h:panelGroup>
                        <p:inputText id="icode" value="#{requestManager.newCode}" required="true" requiredMessage="Please enter a mnemonic." />
                        <p:watermark for="icode" value="e.g. FluxC" />
                        <p:message for="icode" />
                    </h:panelGroup>

                    <h:outputLabel for="icomm" value="Comment (optional):" />
                    <h:panelGroup>
                        <p:inputTextarea id="icomm" rows="5" cols="60" counter="icounter" maxlength="254" value="#{requestManager.newComment}" counterTemplate="{0} characters remaining." autoResize="false"/>
                        <br/>
                        <h:outputText id="icounter" />
                    </h:panelGroup>
                </p:panelGrid>

                <p:separator />

                <p:commandButton value="Submit" style="float: left" update="grid :ReqSubForm" oncomplete="if (args &amp;&amp; !args.validationFailed) addName.hide()" action="#{requestManager.onAdd()}" />
                <p:commandButton value="Cancel" style="float: right" onclick="addName.hide()"  />
            </p:dialog>
        </h:form>

        <!-- ===================Modify Form================================= -->
        <h:form id="ModNameForm" >
            <p:dialog id="modName" widgetVar="modName">
                <f:facet name="header">
                    <h:outputText value="Request to Change Name"/>
                </f:facet>
                <p:panelGrid id="pgrid" style="text-align: left">
                    <f:facet name="header">
                        <p:row>
                            <p:column><h:outputText value="" /></p:column>
                            <p:column><h:outputText value="Current Value" /></p:column>
                            <p:column><h:outputText value="New Value" /></p:column>
                        </p:row>
                    </f:facet>

                    <p:row>
                        <p:column><h:outputLabel for="mdesc" value="Name:" /></p:column>
                        <p:column><h:outputText value="#{requestManager.selectedName.fullName}"/></p:column>
                        <p:column>
                            <p:inputText id="mdesc" value="#{requestManager.newDescription}" required="true" requiredMessage="Please enter a name." />
                            <p:message for="mdesc" />
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column><h:outputLabel for="mcode" value="Mnemonic:" /> </p:column>
                        <p:column><h:outputText value="#{requestManager.selectedName.name}" /></p:column>
                        <p:column>
                            <p:inputText id="mcode" value="#{requestManager.newCode}" required="true" requiredMessage="Please enter a mnemonic." />
                            <p:message for="mcode" />
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column><h:outputLabel for="mcomm" value="Comment (optional):" /></p:column>
                        <p:column colspan="2" >
                            <p:inputTextarea id="mcomm"  counter="mcounter" maxlength="254" value="#{requestManager.newComment}" rows="5" cols="60" counterTemplate="{0} characters remaining." autoResize="false"/>
                            <br/>
                            <h:outputText id="mcounter" />
                        </p:column>
                    </p:row>

                </p:panelGrid>
                <p:separator />

                <p:commandButton value="Submit" style="float: left" update="pgrid :ReqSubForm" oncomplete="if (args &amp;&amp; !args.validationFailed) modName.hide()" action="#{requestManager.onModify()}"/>
                <p:commandButton value="Cancel" style="float: right" onclick="modName.hide()" />
            </p:dialog>
        </h:form>

        <!-- ===================Delete Form================================= -->
        <h:form id="DelNameForm" >
            <p:dialog id="delName"  widgetVar="delName">
                <f:facet name="header">
                    <h:outputText value="Request to Delete/Retire Names"/>
                </f:facet>
                <p:panelGrid id="pgrid" style="text-align: left">
                    <p:row>
                        <p:column colspan="2" rendered="#{requestManager.canDelete()}">
                            <p:tree value="#{requestManager.deleteView}" var="candidate" style="width: 100%; height: 150px;">
                                <p:treeNode>
                                    <h:outputText styleClass="#{candidate.delete ? 'Processing Delete-Processing' : ''}" value="#{candidate.fullName} (#{candidate.name})" />
                                </p:treeNode>
                            </p:tree>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column>
                            <h:outputLabel for="dcomm" value="Comment (optional):" />
                        </p:column>
                        <p:column>
                            <p:inputTextarea id="dcomm" rows="5" cols="40" counter="dcounter" maxlength="254" value="#{requestManager.newComment}" counterTemplate="{0} characters remaining." autoResize="false"/>
                            <br/>
                            <h:outputText id="dcounter" />
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:separator />

                <p:commandButton value="Submit" style="float: left" update=":ReqSubForm" oncomplete="delName.hide()" action="#{requestManager.onDelete()}"/>
                <p:commandButton value="Cancel" style="float: right" onclick="delName.hide()"  />
            </p:dialog>
        </h:form>

        <!-- ===================Cancel Form    ============================ -->
        <h:form id="CancelReqForm" >
            <p:dialog id="cancelReq" widgetVar="cancelReq">
                <f:facet name="header">
                    <h:outputText value="Cancel request"/>
                </f:facet>
                <p:panelGrid id="pgrid" style="text-align: left">
                    <p:row>
                        <p:column colspan="2">
                            <p:tree value="#{requestManager.cancelView}" var="candidate" style="width: 100%; height: 150px;">
                                <p:treeNode>
                                    <h:outputText styleClass="#{candidate.delete ? 'Processing Delete-Processing' : ''}" value="#{candidate.fullName} (#{candidate.name})" />
                                </p:treeNode>
                            </p:tree>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column>
                            <h:outputLabel for="dcomm" value="Comment (optional):" />
                        </p:column>
                        <p:column>
                            <p:inputTextarea id="dcomm" rows="5" cols="40" counter="dcounter" maxlength="254" value="#{requestManager.newComment}" counterTemplate="{0} characters remaining." autoResize="false"/>
                            <br/>
                            <h:outputText id="dcounter" />
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:separator />

                <p:commandButton value="Submit" style="float: left" update=":ReqSubForm" oncomplete="cancelReq.hide()" action="#{requestManager.onCancel()}"/>
                <p:commandButton value="Cancel" style="float: right" onclick="cancelReq.hide()"  />
            </p:dialog>
        </h:form>

        <h:form id="ApproveForm" >
            <p:dialog id="approveRequest"  widgetVar="approveRequest">
                <f:facet name="header">
                    <h:outputText value="Approve"/>
                </f:facet>
                <p:panelGrid style="text-align: left" >
                    <p:row>
                        <p:column><h:outputLabel for="acomm" value="Approval Comments (optional):" /></p:column>
                        <p:column>
                            <p:inputTextarea id="acomm" rows="5" cols="40" counter="counter" maxlength="254" value="#{requestManager.newComment}" counterTemplate="{0} characters remaining." autoResize="false"/>
                            <br/>
                            <h:outputText id="counter" />
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:separator />

                <p:commandButton value="Approve" style="float: left" update=":ReqSubForm" oncomplete="approveRequest.hide()" action="#{requestManager.onApprove()}"/>
                <p:commandButton value="Cancel" style="float: right" onclick="approveRequest.hide()" />
            </p:dialog>
        </h:form>

        <h:form id="RejectForm">
            <p:dialog id="rejectRequest"  widgetVar="rejectRequest">
                <f:facet name="header">
                    <h:outputText value="Reject"/>
                </f:facet>
                <p:panelGrid style="text-align: left" >
                    <p:row>
                        <p:column><h:outputLabel for="rcomm" value="Rejection Comments (optional):" /></p:column>
                        <p:column>
                            <p:inputTextarea id="rcomm" rows="5" cols="40" counter="counter" maxlength="254" value="#{requestManager.newComment}" counterTemplate="{0} characters remaining." autoResize="false"/>
                            <br/>
                            <h:outputText id="counter" />
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:separator />
                <p:commandButton value="Reject" style="float: left" update=":ReqSubForm" oncomplete="rejectRequest.hide()" action="#{requestManager.onReject()}"/>
                <p:commandButton value="Cancel" style="float: right" onclick="rejectRequest.hide()" />
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>