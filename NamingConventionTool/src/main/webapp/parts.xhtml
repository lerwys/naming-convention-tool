<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/namesTemplate.xhtml"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">
	<ui:define name="content">
		<ui:fragment rendered="#{userManager.isLoggedIn()}">
			<!-- =================== Req Sub Form ================================= -->
			<h:form id="ReqSubForm" style="padding:0; margin:0">
				<p:growl globalOnly="true" id="partsMsgs" showDetail="true"
					sticky="false" life="30000" escape="false" />
				<!-- =================== Menus      ============================ -->
				<div id="filterTable">
					<p:panelGrid style="width:100%; border-type:none;" >
						<p:row>
							<p:column >
								<p:outputLabel for="filterMenu" value="Show: " />
								<p:selectOneMenu value="#{namePartsController.viewFilter}"
									id="filterMenu">
									<p:ajax listener="#{namePartsController.modifyDisplayView}"
										event="change" update="namePartsTree reqMenu"
										oncomplete="resizePanel()" />
									<f:selectItem itemLabel="Approved and Proposed"
										itemValue="APPROVED_AND_PROPOSED" />
									<f:selectItem itemLabel="Approved" itemValue="APPROVED" />
									<f:selectItem itemLabel="Proposed" itemValue="PROPOSED" />
									<f:selectItem itemLabel="Archived" itemValue="ARCHIVED" />
								</p:selectOneMenu>
							</p:column>
							<p:column>
								<p:menuButton value="Actions" id="reqMenu" style="z-index: 100; float:right">
									<p:menuitem value="Add"
										actionListener="#{namePartsController.prepareAddPopup()}"
										title="Add Name" icon="ui-icon-plus"
										oncomplete="addName.show()" update=":addNameForm:addName"
										disabled="#{!(namePartsController.canAdd())}"
										rendered="#{userManager.editor}" />
									<p:menuitem value="Delete"
										actionListener="#{namePartsController.prepareDeletePopup()}"
										title="Delete Name" icon="ui-icon-trash"
										update=":DelNameForm:delName" oncomplete="delName.show()"
										disabled="#{!(namePartsController.canDelete())}"
										rendered="#{userManager.editor}" />
									<p:menuitem value="Modify"
										actionListener="#{namePartsController.prepareModifyPopup()}"
										title="Modify Name" icon="ui-icon-pencil"
										update=":ModNameForm:modName" oncomplete="modName.show()"
										disabled="#{!(namePartsController.canModify())}"
										rendered="#{userManager.editor}" />
									<p:menuitem value="Approve"
										actionListener="#{namePartsController.prepareApprovePopup()}"
										title="Approve Request" icon="ui-icon-check"
										update=":ApproveForm" oncomplete="approveRequest.show()"
										disabled="#{!(namePartsController.canApprove())}"
										rendered="#{userManager.superUser}" />
									<p:menuitem value="Reject" 
										actionListener="#{namePartsController.prepareRejectPopup()}"
										title="Reject Request"
										icon="ui-icon-close" update=":RejectForm"
										oncomplete="rejectRequest.show()"
										disabled="#{!(namePartsController.canCancel())}"
										rendered="#{userManager.superUser}" />
									<p:menuitem value="Cancel" 
										actionListener="#{namePartsController.prepareCancelPopup()}"									
										title="Cancel changes"
										icon="ui-icon-close" update=":CancelReqForm:cancelReq"
										oncomplete="cancelReq.show()"
										disabled="#{!(namePartsController.canCancel())}"
										rendered="#{userManager.editor and !userManager.superUser}" />
									<p:menuitem value="History" title="View History"
										icon="ui-icon-search"
										actionListener="#{namePartsController.prepareHistoryPopup()}"
										update=":ReqSubForm:historyTable"
										oncomplete="nameDetail.show()"
										disabled="#{!(namePartsController.canShowHistory())}" />
								</p:menuButton>
							</p:column>
						</p:row>
					</p:panelGrid>
				</div>

				<!-- =================== Tree Table ================================= -->
				<ui:include src="/WEB-INF/includes/parts-treetable.xhtml">
					<ui:param name="treeId" value="namePartsTree" />
					<ui:param name="view" value="#{namePartsController.viewRoot}" />
					<ui:param name="selectionMode" value="multiple" />
					<ui:param name="update" value=":ReqSubForm:reqMenu" />
				</ui:include>
				<!-- =================== History ================================= -->
				<ui:include src="/WEB-INF/includes/parts-history.xhtml">
					<ui:param name="historyHandler"
						value="#{namePartsController.historyRevisions}" />
				</ui:include>
			</h:form>

			<!-- ===================Add Form================================= -->
			<ui:include src="/WEB-INF/includes/parts-wizard.xhtml">
				<ui:param name="formId" value="addNameForm" />
				<ui:param name="widgetId" value="addName" />
				<ui:param name="widgetTitle" value="Request to Add name element" />
				<ui:param name="gridId" value="grid" />
				<ui:param name="fullName" value="#{namePartsController.formName}" />
				<ui:param name="validator" value="custom.addMnemonicValidator" />
				<ui:param name="warning" value="displayMnemonicLengthWarningOnAdd()" />
				<ui:param name="mnemonic"
					value="#{namePartsController.formMnemonic}" />
				<ui:param name="required" value="#{namePartsController.isAddMnemonicRequired()}"/>
				<ui:param name="description"
					value="#{namePartsController.formDescription}" />
				<ui:param name="comment" value="#{namePartsController.formComment}" />
				<ui:param name="submitHandler" value="onAdd" />
			</ui:include>

			<!-- ===================Modify Form================================= -->
			<ui:include src="WEB-INF/includes/parts-wizard.xhtml">
				<ui:param name="formId" value="ModNameForm" />
				<ui:param name="widgetId" value="modName" />
				<ui:param name="gridId" value="pgrid" />
				<ui:param name="widgetTitle" value="Request to Change Name" />
				<ui:param name="fullName" value="#{namePartsController.formName}" />
				<ui:param name="mnemonic"
					value="#{namePartsController.formMnemonic}" />
				<ui:param name="required" value="#{namePartsController.isModifyMnemonicRequired()}"/>
				<ui:param name="validator" value="custom.modifyMnemonicValidator" />
				<ui:param name="warning" value="displayMnemonicLengthWarningOnMod()" />
				<ui:param name="description"
					value="#{namePartsController.formDescription}" />
				<ui:param name="comment" value="#{namePartsController.formComment}" />
				<ui:param name="submitHandler" value="onModify" />
			</ui:include>

			<!-- ===================Delete Form================================= -->
				<ui:include src="/WEB-INF/includes/parts-operationtreeform.xhtml">
					<ui:param name="formId" value="DelNameForm" />
					<ui:param name="widgetId" value="delName" />
					<ui:param name="dialogHeader" value="Request to Delete"/>
					<ui:param name="view" value="#{namePartsController.deleteView}" />
					<ui:param name="operation" value="Delete"/>
					<ui:param name="messageRequired" value="false" />
					<ui:param name="submitHandler" value="onDelete"/>
				</ui:include>

			<!-- =================== Cancel Form ============================ -->
				<ui:include src="/WEB-INF/includes/parts-operationtreeform.xhtml">
					<ui:param name="formId" value="CancelReqForm" />
					<ui:param name="widgetId" value="cancelReq" />
					<ui:param name="dialogHeader" value="Cancel proposals, modifications and/or deletions"/>
					<ui:param name="view" value="#{namePartsController.cancelView}" />
					<ui:param name="operation" value="Cancel"/>
					<ui:param name="messageRequired" value="false" />
					<ui:param name="submitHandler" value="onCancel"/>
				</ui:include>
					
			<!-- ===================    Approve Form    ============================ -->
				<ui:include src="/WEB-INF/includes/parts-operationtreeform.xhtml">
					<ui:param name="formId" value="ApproveForm" />
					<ui:param name="widgetId" value="approveRequest" />
					<ui:param name="dialogHeader" value="Approve proposals, modifications and/or deletions"/>
					<ui:param name="view" value="#{namePartsController.approveView}" />
					<ui:param name="operation" value="Approve"/>
					<ui:param name="messageRequired" value="false" />
					<ui:param name="submitHandler" value="onApprove"/>
				</ui:include>

			<!-- ===================    Reject Form    ============================ -->
				<ui:include src="/WEB-INF/includes/parts-operationtreeform.xhtml">
					<ui:param name="formId" value="RejectForm" />
					<ui:param name="widgetId" value="rejectRequest" />
					<ui:param name="dialogHeader" value="Reject proposals, modifications and/or deletions"/>
					<ui:param name="view" value="#{namePartsController.cancelView}" />
					<ui:param name="operation" value="Reject"/>
					<ui:param name="messageRequired" value="true" />
					<ui:param name="submitHandler" value="onReject"/>
				</ui:include>

		</ui:fragment>
	</ui:define>
</ui:composition>