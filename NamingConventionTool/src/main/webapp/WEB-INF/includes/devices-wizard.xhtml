<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html">

	<h:form id="#{formId}">
		<p:dialog widgetVar="#{widgetName}" header="#{dialogTitle}" modal="true" width="800">
			<p:growl id="growl" sticky="true" showDetail="true" />
			<p:wizard widgetVar="wiz"
				flowListener="#{deviceWizardController.onFlowProcess}"
				showStepStatus="false">

				<p:tab id="areaTab" title="Area">

					<p>Which part of the facility does the device provide service
						to?</p>
					<h3>1. Select functional area:</h3>
					<p:separator />
					<p:tree value="#{deviceWizardController.sections}"
						selectionMode="single" var="section"
						selection="#{deviceWizardController.formSelectedSection}"
						dynamic="true">
						<p:ajax event="select" update=":#{formId}:bsub" />
						<p:ajax event="unselect" update=":#{formId}:bsub" />
						<p:ajax event="expand"
							listener="#{treeNodeManager.onNodeExpand}" />
						<p:ajax event="collapse"
							listener="#{treeNodeManager.onNodeCollapse}" />
						<p:treeNode>
							<h:outputText 
								value="${deviceWizardController.mnemonic(section)} "
								styleClass="sec"
								rendered="#{deviceWizardController.mnemonic(section) != null}" />
							<h:outputText id="sectionName" value="#{section.name}"  />
							<p:tooltip for="sectionName" value="#{section.description}"/>
							<h:outputText value=" (#{section.mnemonic})" rendered="#{section.mnemonic !=null}"  />
						</p:treeNode>
					</p:tree>
					<p:separator />
					<p:messages />
					<p>Name elements are described and managed in the area structure.</p>
				</p:tab>

				<p:tab id="deviceTab" title="Device">
					<p>What kind of device is it?</p>
					<h3>2. Select device definition:</h3>
					<p:separator />
					<p:tree value="#{deviceWizardController.deviceTypes}"
						selectionMode="single" var="devType"
						selection="#{deviceWizardController.formSelectedDeviceType}"
						dynamic="true">
						<p:ajax event="select" update=":#{formId}:bsub" />
						<p:ajax event="unselect" update=":#{formId}:bsub" />
						<p:ajax event="expand"
							listener="#{treeNodeManager.onNodeExpand}" />
						<p:ajax event="collapse"
							listener="#{treeNodeManager.onNodeCollapse}" />
						<p:treeNode>
							<h:outputText 
								value=" #{deviceWizardController.mnemonic(devType)} "
								styleClass="dev"
								rendered="#{deviceWizardController.mnemonic(devType) != null}" />
							<h:outputText 								
								id="deviceName"
								value="#{devType.name}" />
							<p:tooltip for="deviceName" value="devType.description"/>
							<h:outputText value=" (#{devType.mnemonic})" rendered="#{devType.mnemonic != null}"  />
							
						</p:treeNode>
					</p:tree>
					<p:separator />
					<p:messages />
					<p>Name elements are described and managed in the device structure.</p>
				</p:tab>

				<p:tab id="instanceTab" title="Instance">
					<h3>3. Enter instance index:</h3>
					<p:inputText id="instanceIndex" onkeyup="displayIndexLengthWarningOnAdd()"
						value="#{deviceWizardController.formInstanceIndex}" style="width:480px"
						maxlenght="6">
						<f:validator validatorId="#{instanceIndexValidator}" />
					</p:inputText>
					<p:message for="instanceIndex" />
					<div id="#{widgetName}:indexLengthWarning"
						class="ui-message ui-message-warn ui-widget ui-corner-all"
						style="display: none">
						<span class="ui-message-warn-icon"></span> <span
							class="ui-message-warn-detail">Instance index should
							preferably be less than 4 characters although 6 is allowed.</span>
					</div>

					<h4>The instance index is validated against the following
						rules:</h4>
					<ol>
						<li>The instance index is alphanumeric. I.e., only upper and
							lower case alphanumeric characters (a-z, A-Z, 0-9) are allowed.</li>
						<li>The instance instance index ranges between 0 and 6
							characters.</li>
						<li>Within the selected area (<sec>Sec-Sub</sec>) and for the
							selected device definition (<dev>Dis-Dev</dev>) the instance
							index is unique, irrespective of
							<ul>
								<li>Letter case</li>
								<li>Letters I, l and number 1</li>
								<li>Letter O and number 0</li>
								<li>Letters V and W</li>
								<li>Leading zeros, i.e., number 0 immediately following a
									non-numerical character</li>
							</ul>
						</li>
					</ol>
					<h4>Guidelines:</h4>
					<ol>
						<li>Names should be short, meaningful and easy to read.
							Abbreviate and use CamelCase.</li>
						<li>Names should be easy to pronounce and memorise.</li>
					</ol>

				</p:tab>

				<p:tab id="finishTab" title="Finish">
					<div class="wizardStyle">
						<h3>4. Finish:</h3>
						<h4>Review the Device Name:</h4>
						<kbd>
							<h:outputText value="#{deviceWizardController.formDeviceName}" />
						</kbd>
						<h4>Enter a Comment (optional):</h4>
						<p:inputTextarea id="additionalInfo"
							value="#{deviceWizardController.formAdditionalInfo}"
							style="width:460px; height:200px" />

						<h4>Confirm:</h4>
						<div align="right">
							<p:commandButton id="bsub" value="Submit"
								update=":ManageNameForm"
								style="float:right"
								actionListener="#{deviceWizardController[submitHandler]}"
								disabled="#{deviceWizardController.formSelectedSection == null || deviceWizardController.formSelectedDeviceType == null}"
								oncomplete="wiz.loadStep(wiz.cfg.steps[0],true); #{widgetName}.hide(); resizePanel()"/>
							<p:commandButton value="Cancel"
								onclick="wiz.loadStep(wiz.cfg.steps[0],true);  #{widgetName}.hide();"
								style="float:right" />
						</div>
					</div>
				</p:tab>
			</p:wizard>
		</p:dialog>

	</h:form>

</ui:composition>